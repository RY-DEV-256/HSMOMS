{% extends 'hsmoms/admin/admin_dashboard.html' %} 

{% block content %}
<h6 class="text-muted">Admin | Manage Doctors</h6>

    <div class="d-flex justify-content-between mb-2">
    <form method="GET" action="" class="d-sm-none d-md-block">
        <input type="text" name="q" placeholder="Search by first name" />
        <button type="submit" class="btn btn-primary btn-sm">Search</button>
    </form>
    <a href="{% url 'create_doctor' %}" class="btn btn-primary btn-sm">Create Doctor</a>
    </div>

<div class="table-responsive">
  {% if page_obj %}
  <table class="table table-bordered table-hover">
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Phone Number</th>
        <th>Address</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      {% for doctor in page_obj.object_list %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ doctor.first_name }} {{ doctor.admin.last_name }}</td>
        <td>{{ doctor.phone }}</td>
        <td>{{ doctor.address }}</td>
        <td>
          <div class="d-flex">
            
            <!--View Button trigger modal -->
            <button
              type="button"
              class="btn btn-success btn-sm"
              data-bs-toggle="modal"
              data-bs-target="#view{{doctor.admin.id}}"
            >
              View
            </button>
            
            <!--View Modal -->
            <div
              class="modal fade"
              id="view{{doctor.admin.id}}"
              data-bs-backdrop="static"
              data-bs-keyboard="false"
              tabindex="-1"
              aria-labelledby="staticBackdropLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog  modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">
                        Doctor Information!
                    </h1>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <div class="col-md-12 mx-auto">
                        <img src="{{ doctor.profile_pic }}" style="border-radius: 50%;"  class="img-fluid col-md-6 mx-auto">
                    </div>
                    <div class="mt-3">
                        <label>Name :</label>
                        <input type="text" disabled
                            placeholder="Dr. {{ doctor.admin.first_name }} {{ doctor.admin.last_name }}"
                            class="form-control">
                        <label>Email :</label>
                        <input type="text" disabled
                            placeholder="{{ doctor.admin.email }}"
                            class="form-control">
                        <label>Phone Number :</label>
                        <input type="text" disabled
                            placeholder="{{ doctor.phone }}"
                            class="form-control">
                        <label>Address :</label>
                        <input type="text" disabled
                            placeholder="{{ doctor.address }}"
                            class="form-control">
                        <label>Specialization :</label>
                        <input type="text" disabled
                            placeholder="{{ doctor.specialization_id.field }}"
                            class="form-control">
                        <label>Schedule :</label>
                        <input type="text" disabled
                            placeholder="{{ doctor.schedule_id.working_days }} - {{ doctor.schedule_id.working_time }}"
                            class="form-control">

                        <label>Last Login :</label>
                        <input type="text" disabled
                            placeholder="{{ doctor.admin.last_login }}"
                            class="form-control">

                    </div>
                  </div>
                </div>
              </div>
            </div>

            <a
              href="{% url 'edit_doctor' pk=doctor.admin.id %}"
              class="btn btn-primary mx-3 btn-sm"
              >Edit</a
            >

            <!--Delete Button trigger modal -->
            <button
              type="button"
              class="btn btn-danger btn-sm"
              data-bs-toggle="modal"
              data-bs-target="#delete{{doctor.admin.id}}"
            >
              Delete
            </button>

            <!--Delete Modal -->
            <div
              class="modal fade"
              id="delete{{doctor.admin.id}}"
              data-bs-backdrop="static"
              data-bs-keyboard="false"
              tabindex="-1"
              aria-labelledby="staticBackdropLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">
                        Confirm Deletion of Doctor!
                    </h1>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to delete
                    <span class="text-danger"> {{doctor.admin.first_name}} {{doctor.admin.last_name}}?</span>
                    <div class="mt-5">
                      <form
                        action="{% url 'delete_doctor' pk=doctor.admin.id %}"
                        method="post"
                      >
                        {% csrf_token %}
                        <div class="d-flex">
                          <button type="submit" class="btn btn-danger">
                            Yes, I'm Sure
                          </button>

                          <button
                            type="button"
                            class="btn btn-secondary mx-2"
                            data-bs-dismiss="modal"
                          >
                            No, Cancel
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

  <div class="pagination d-flex justify-content-between">
    <div class="step-links">
      <span class="current">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
      </span>
    </div>
    <span class="step-links">
      {% if page_obj.has_previous %}
      <a
        href="?page={{ page_obj.previous_page_number }}"
        class="btn btn-secondary"
        >Previous</a
      >
      {% endif %} {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" class="btn btn-secondary"
        >Next</a
      >
      {% endif %}
    </span>
  </div>
  {% else %}
  <div class="text-center my-3">
    <p>No Doctors found matching the search query.</p>
  </div>
  {% endif %}
  
{% endblock content %}
